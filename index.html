<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pittsburgh Walks Leaderboard</title>

  <!--
    FONTS: We load two Google Fonts here.
    - "Bebas Neue": Bold display font for the title
    - "DM Sans": Clean, readable font for everything else
    To change fonts, browse https://fonts.google.com and swap these URLs.
  -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">

  <!--
    STYLES: Controls how the page looks.

    COLOR SCHEME (Pittsburgh's black & gold):
    - --bg: Dark charcoal background
    - --gold: Primary accent color (Pittsburgh gold)
    - --gold-dim: Subtle gold for borders/details
    - --text: Light text for readability
    - --text-dim: Muted text for secondary info

    To customize, edit the color values in :root below.
  -->
  <style>
    :root {
      --bg: #1a1a1a;
      --bg-card: #242424;
      --gold: #ffb81c;
      --gold-dim: rgba(255, 184, 28, 0.15);
      --text: #f5f5f5;
      --text-dim: #888;
      --bronze: #cd7f32;
      --silver: #c0c0c0;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'DM Sans', sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      padding: 2rem 1rem 4rem;
      /* Subtle noise texture for depth */
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.85' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%' height='100%' filter='url(%23noise)'/%3E%3C/svg%3E");
      background-blend-mode: overlay;
      background-size: 150px;
    }

    .container {
      max-width: 600px;
      margin: 0 auto;
    }

    /* HEADER: Title and walking icon */
    header {
      text-align: center;
      margin-bottom: 2rem;
      animation: fadeDown 0.6s ease-out;
    }

    .icon {
      font-size: 3rem;
      margin-bottom: 0.5rem;
      display: block;
    }

    h1 {
      font-family: 'Bebas Neue', sans-serif;
      font-size: clamp(2.5rem, 8vw, 4rem);
      letter-spacing: 0.05em;
      color: var(--gold);
      text-shadow: 0 2px 20px rgba(255, 184, 28, 0.3);
      line-height: 1;
    }

    .subtitle {
      color: var(--text-dim);
      font-size: 0.95rem;
      margin-top: 0.5rem;
    }

    #total {
      background: var(--gold-dim);
      border: 1px solid rgba(255, 184, 28, 0.3);
      border-radius: 2rem;
      padding: 0.6rem 1.5rem;
      display: inline-block;
      margin-top: 1rem;
      font-weight: 500;
      font-size: 0.9rem;
      animation: fadeUp 0.6s ease-out 0.2s both;
    }

    /* LEADERBOARD TABLE */
    .leaderboard {
      background: var(--bg-card);
      border-radius: 1rem;
      overflow: hidden;
      box-shadow: 0 4px 30px rgba(0, 0, 0, 0.4);
      animation: fadeUp 0.6s ease-out 0.3s both;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    thead {
      background: rgba(255, 255, 255, 0.05);
      text-transform: uppercase;
      font-size: 0.75rem;
      letter-spacing: 0.1em;
      color: var(--text-dim);
    }

    th, td {
      padding: 1rem;
      text-align: left;
    }

    th:first-child, td:first-child { text-align: center; width: 4rem; }
    th:last-child, td:last-child { text-align: right; width: 5rem; }

    tbody tr {
      border-top: 1px solid rgba(255, 255, 255, 0.05);
      transition: background 0.2s ease;
    }

    tbody tr:hover {
      background: rgba(255, 184, 28, 0.05);
    }

    /* TOP 3 MEDAL STYLING */
    .rank { font-weight: 700; font-size: 1.1rem; }
    .rank-1 .rank { color: var(--gold); }
    .rank-2 .rank { color: var(--silver); }
    .rank-3 .rank { color: var(--bronze); }

    .rank-1 { background: linear-gradient(90deg, rgba(255, 184, 28, 0.15) 0%, transparent 100%); }
    .rank-2 { background: linear-gradient(90deg, rgba(192, 192, 192, 0.1) 0%, transparent 100%); }
    .rank-3 { background: linear-gradient(90deg, rgba(205, 127, 50, 0.1) 0%, transparent 100%); }

    .medal {
      display: inline-block;
      width: 1.8rem;
      height: 1.8rem;
      line-height: 1.8rem;
      border-radius: 50%;
      font-size: 0.85rem;
    }

    .rank-1 .medal { background: var(--gold); color: #1a1a1a; }
    .rank-2 .medal { background: var(--silver); color: #1a1a1a; }
    .rank-3 .medal { background: var(--bronze); color: #1a1a1a; }

    .username {
      font-weight: 500;
    }

    .count {
      font-weight: 700;
      color: var(--gold);
      font-size: 1.1rem;
    }

    /* Row stagger animation */
    tbody tr {
      animation: fadeIn 0.4s ease-out both;
    }

    /* ANIMATIONS */
    @keyframes fadeDown {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    /* FOOTER */
    footer {
      text-align: center;
      margin-top: 2rem;
      color: var(--text-dim);
      font-size: 0.8rem;
      animation: fadeUp 0.6s ease-out 0.5s both;
    }

    footer a {
      color: var(--gold);
      text-decoration: none;
    }

    footer a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <!--
    PAGE CONTENT: The visible structure of the leaderboard.
    The table body (#leaderboard) gets filled in automatically by the script below.
  -->
  <div class="container">
    <header>
      <span class="icon">ðŸš¶</span>
      <h1>Pittsburgh Walks</h1>
      <p class="subtitle">Sidewalk Survey Leaderboard</p>
      <p id="total"></p>
    </header>

    <div class="leaderboard">
      <table>
        <thead>
          <tr>
            <th>Rank</th>
            <th>Surveyor</th>
            <th>Surveys</th>
          </tr>
        </thead>
        <tbody id="leaderboard-body"></tbody>
      </table>
    </div>

    <footer>
      Helping make Pittsburgh's sidewalks safer for everyone.
    </footer>
  </div>

  <!--
    SCRIPT: Loads the CSV file and builds the leaderboard.

    HOW IT WORKS:
    1. Fetches data/raw-survey.csv from the same folder as this HTML file
    2. Counts how many surveys each Username submitted
    3. Sorts users by count (highest first) and displays the results

    TO UPDATE THE LEADERBOARD: Just replace raw-survey.csv with new data.
    The page will reflect the changes automatically when refreshed.
  -->
  <script>
    // Load the CSV file
    fetch('data/raw-survey.csv')
      .then(r => r.text())
      .then(csv => {
        // Split CSV into rows and find the "Username" column
        const lines = csv.split('\n');
        const headers = parseCSVLine(lines[0]);
        const usernameIdx = headers.indexOf('Username');

        // Count surveys per user
        const counts = {};
        let total = 0;
        for (let i = 1; i < lines.length; i++) {
          if (!lines[i].trim()) continue;  // Skip empty lines
          const row = parseCSVLine(lines[i]);
          const user = row[usernameIdx]?.trim();
          if (user) {
            counts[user] = (counts[user] || 0) + 1;
            total++;
          }
        }

        // Sort by count (descending) and display
        const sorted = Object.entries(counts).sort((a, b) => b[1] - a[1]);
        document.getElementById('total').textContent = `${total.toLocaleString()} surveys Â· ${sorted.length} contributors`;

        // Build table rows with rank styling and staggered animation
        document.getElementById('leaderboard-body').innerHTML = sorted
          .map(([user, count], i) => {
            const rankClass = i < 3 ? `rank-${i + 1}` : '';
            const rankDisplay = i < 3
              ? `<span class="medal">${i + 1}</span>`
              : i + 1;
            const delay = Math.min(i * 0.05, 1);  // Stagger animation, max 1s delay
            return `<tr class="${rankClass}" style="animation-delay: ${delay}s">
              <td class="rank">${rankDisplay}</td>
              <td class="username">${escapeHtml(user)}</td>
              <td class="count">${count}</td>
            </tr>`;
          })
          .join('');
      });

    // Helper: Parses a single CSV line, handling commas inside quoted fields
    function parseCSVLine(line) {
      const result = [];
      let current = '';
      let inQuotes = false;
      for (const char of line) {
        if (char === '"') inQuotes = !inQuotes;
        else if (char === ',' && !inQuotes) { result.push(current); current = ''; }
        else current += char;
      }
      result.push(current);
      return result;
    }

    // Helper: Prevents HTML injection from usernames (security best practice)
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }
  </script>
</body>
</html>
